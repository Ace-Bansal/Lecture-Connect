'use strict';

// { A3, Oauth3, PromiseA }
module.exports.create = function (deps) {
  var Oauth3 = deps.Oauth3;
  //var PromiseA = deps.PromiseA;
  // { A3, PromiseA }
  var requests = require('./requests').create(deps);



  var Tunnel = Oauth3.Tunnel = {};
  Tunnel.token = function (options) {
    options.CLI = options.CLI || deps.CLI;
    return Oauth3.login(options).then(function (state) {
      // { jwt, tunnelUrl }
      return requests.tunnel.token(
        state.oauth3
      , state.session
      , { domains: options.domains
        , device: state.device.hostname
        }
      );
    });
  };



  return Oauth3;
};
