'use strict';

module.exports.create = function (deps) {
  //var PromiseA = deps.PromiseA;
  var A3 = deps.Oauth3.A3;
  var requests = {};

  // Files
  requests.tunnel = {};

  requests.tunnel.token = function (directive, session, params) {
    var dir = directive.tunnelToken || {
      method: 'POST'
    , url: 'https://' + directive.api + '/api/org.oauth3.tunnel/accounts/:accountId/token'
    , bearer: 'Bearer'
    };
    var url = dir.url
      .replace(/:accountId/, session.acx)
    ;

    // { jwt, tunnelUrl }
    return A3.request({
      method: dir.method || 'GET'
    , url: url
    , headers: {
        'Authorization': (dir.bearer || 'Bearer') + ' ' + session.accessToken
      }
      // { domains: [ '...' ] , device: '...' }
    , json: params
    });
  };


  return requests;
};
